<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Chat</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<style>
#chat { border:1px solid #ccc; padding:10px; width:400px; height:300px; overflow-y:auto; margin-top:10px; }
#message { width:300px; }
button, input { margin: 5px 0; }
.notification { color: green; font-style: italic; }
</style>
</head>
<body>
<h1>Live Chat</h1>

<button id="create_room_btn">Create Chat Room</button>
<p id="my_code"></p>

<input id="room_code_input" placeholder="Enter room code">
<button id="join_room_btn">Join Chat Room</button>

<div id="chat"></div>
<input id="message" placeholder="Type a message">
<button id="send">Send</button>

<script>
const socket = io();

const chat = document.getElementById("chat");
const input = document.getElementById("message");
const sendBtn = document.getElementById("send");
const createBtn = document.getElementById("create_room_btn");
const joinBtn = document.getElementById("join_room_btn");
const roomInput = document.getElementById("room_code_input");
const myCodeDisplay = document.getElementById("my_code");

let currentRoom = null;

// --- Create Room ---
createBtn.onclick = () => {
    socket.emit("create_room");
};

// --- Join Room ---
joinBtn.onclick = () => {
    const code = roomInput.value.trim().toUpperCase();
    if(code){
        currentRoom = code;
        socket.emit("join_room", {code});
    }
};

// --- Send Message ---
sendBtn.onclick = () => {
    if(!currentRoom) return alert("Join or create a room first!");
    const text = input.value.trim();
    if(text){
        socket.emit("message", {room: currentRoom, text});
        input.value = "";
    }
};

// --- Receive Events ---
socket.on("message", (msg) => {
    if(typeof msg === "object" && msg !== null && msg.action){
        if(msg.action === "room_created"){
            currentRoom = msg.code;
            myCodeDisplay.textContent = "Your join code: " + currentRoom;
            appendNotification("Room created! Share this code: " + currentRoom);
        } else if(msg.action === "joined_room"){
            myCodeDisplay.textContent = "Joined room: " + msg.code;
            appendNotification("Joined room: " + msg.code);
        }
    } else if(typeof msg === "string"){
        appendMessage(msg);
    }
});

function appendMessage(text){
    const p = document.createElement("p");
    p.textContent = text;
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
}

function appendNotification(text){
    const p = document.createElement("p");
    p.textContent = text;
    p.className = "notification";
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
